<script>
    const roleSelect = document.getElementById('role');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const classroomCodeLabel = document.getElementById('classroomCodeLabel');
    const classroomCodeInput = document.getElementById('classroomCode');
    const teacherInfoMessage = document.getElementById('teacherInfoMessage');

    function handleRoleChange() {
        if (roleSelect.value === 'student') {
            // Pour les élèves : afficher le champ de code de classe
            classroomCodeLabel.style.display = 'block';
            classroomCodeInput.style.display = 'block';
            classroomCodeInput.setAttribute('required', 'required');

            // Réactiver et vider les champs username/password
            usernameInput.value = '';
            // --- CORRECTION HERE ---
            usernameInput.disabled = false; // Ensure it's not disabled for students
            usernameInput.readOnly = false; // Ensure it's not read-only for students
            // --- END CORRECTION ---
            passwordInput.value = '';
            // --- CORRECTION HERE ---
            passwordInput.disabled = false; // Ensure it's not disabled for students
            passwordInput.readOnly = false; // Ensure it's not read-only for students
            // --- END CORRECTION ---

            // Cacher le message d'info professeur
            teacherInfoMessage.style.display = 'none';

        } else if (roleSelect.value === 'teacher') {
            // Pour les professeurs : masquer le champ de code de classe
            classroomCodeLabel.style.display = 'none';
            classroomCodeInput.style.display = 'none';
            classroomCodeInput.removeAttribute('required');
            classroomCodeInput.value = ''; // Vider la valeur

            // Pré-remplir et rendre les champs username/password en lecture seule
            usernameInput.value = 'teacher';
            // --- CORRECTION HERE ---
            usernameInput.disabled = false; // CRITICAL: Must be false for value to be sent
            usernameInput.readOnly = true; // Use readOnly to prevent editing but allow sending
            // --- END CORRECTION ---
            passwordInput.value = '123456';
            // --- CORRECTION HERE ---
            passwordInput.disabled = false; // CRITICAL: Must be false for value to be sent
            passwordInput.readOnly = true; // Use readOnly to prevent editing but allow sending
            // --- END CORRECTION ---

            // Afficher le message d'info professeur
            teacherInfoMessage.style.display = 'block';

        } else {
            // Quand "Sélectionnez un rôle" est choisi
            classroomCodeLabel.style.display = 'none';
            classroomCodeInput.style.display = 'none';
            classroomCodeInput.removeAttribute('required');
            classroomCodeInput.value = '';

            usernameInput.value = '';
            // --- CORRECTION HERE ---
            usernameInput.disabled = false;
            usernameInput.readOnly = false;
            // --- END CORRECTION ---
            passwordInput.value = '';
            // --- CORRECTION HERE ---
            passwordInput.disabled = false;
            passwordInput.readOnly = false;
            // --- END CORRECTION ---

            teacherInfoMessage.style.display = 'none';
        }
    }

    // Exécuter la fonction une fois au chargement initial de la page
    handleRoleChange();

    // Attacher l'écouteur d'événement au changement de sélection
    roleSelect.addEventListener('change', handleRoleChange);
</script>
